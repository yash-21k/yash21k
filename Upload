import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class RfiStatusUtil {

    private static final Pattern BIC_PATTERN = Pattern.compile(
            "\\b[A-Z]{4}[A-Z]{2}[A-Z0-9]{2}([A-Z0-9]{3})?\\b"
    );

    private static final Pattern EMAIL_PATTERN = Pattern.compile(
            "(?i)\\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}\\b",
            Pattern.CASE_INSENSITIVE
    );

    /**
     * Extracts and returns either the first email or BIC found in the input string.
     * Priority is given to email if both exist.
     *
     * @param rfiStatus input text
     * @return detected BIC or Email value, or null if none found
     */
    public static String extractBicOrEmail(String rfiStatus) {
        if (rfiStatus == null || rfiStatus.isEmpty()) {
            return null;
        }

        // Check Email first
        Matcher emailMatcher = EMAIL_PATTERN.matcher(rfiStatus);
        if (emailMatcher.find()) {
            return emailMatcher.group();
        }

        // Check BIC next
        Matcher bicMatcher = BIC_PATTERN.matcher(rfiStatus);
        if (bicMatcher.find()) {
            return bicMatcher.group();
        }

        return null;
    }

    /**
     * Checks if the string contains a valid BIC.
     */
    public static boolean hasBic(String rfiStatus) {
        if (rfiStatus == null || rfiStatus.isEmpty()) {
            return false;
        }
        Matcher bicMatcher = BIC_PATTERN.matcher(rfiStatus);
        return bicMatcher.find();
    }

    /**
     * Checks if the string contains a valid Email.
     */
    public static boolean hasEmail(String rfiStatus) {
        if (rfiStatus == null || rfiStatus.isEmpty()) {
            return false;
        }
        Matcher emailMatcher = EMAIL_PATTERN.matcher(rfiStatus);
        return emailMatcher.find();
    }

    // Example usage
    public static void main(String[] args) {
        String ex1 = "Payment sent to HSBCHKHHXXX";
        String ex2 = "Contact DEUTAXISBANK2321@TESTEnvm.com for details";
        String ex3 = "No special data here";

        System.out.println("Extract (BIC): " + extractBicOrEmail(ex1)); // HSBCHKHHXXX
        System.out.println("Has BIC: " + hasBic(ex1)); // true
        System.out.println("Has Email: " + hasEmail(ex1)); // false

        System.out.println("Extract (Email): " + extractBicOrEmail(ex2)); // DEUTAXISBANK2321@TESTEnvm.com
        System.out.println("Has BIC: " + hasBic(ex2)); // false
        System.out.println("Has Email: " + hasEmail(ex2)); // true

        System.out.println("Extract (None): " + extractBicOrEmail(ex3)); // null
    }
}